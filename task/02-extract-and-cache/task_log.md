# Task Log: ETL Часть 1: Схема, Извлечение и Кэширование
**Номер:** 02
**Дата:** 2025-09-20

**Что было сделано (по шагам):**
- Шаг 1: Написан и выполнен идемпотентный скрипт для создания схемы (ограничений уникальности) в Neo4j.
- Шаг 2: Выбран и утвержден источник данных (RecipeNLG dataset с Kaggle).
- Шаг 3: Определены доменные модели `Recipe` и `Ingredient` в виде замороженных датаклассов.
- Шаг 4: Реализован асинхронный, memory-efficient `CsvExtractor` с использованием `pandas` и `asyncio.to_thread`.
- Шаг 5: Написан скрипт `cache_recipes.py`, который использует экстрактор для создания локального кэша `raw_recipes.jsonl`.
- Шаг 6: Проверено создание кэш-файла, что является подготовкой к следующим этапам (Transform & Load).

**Возникшие проблемы и их решения:**
- **Проблема:** Изначальный план не включал создание схемы до загрузки данных.
- **Решение:** В ходе `ideation` план был дополнен шагом по созданию схемы, что является лучшей практикой для обеспечения целостности и производительности данных.

- **Проблема:** Экстрактор падал с ошибкой `AttributeError` из-за некорректного заголовка в исходном CSV-файле.
- **Решение:** Проблема была диагностирована с помощью анализа файла в Jupyter Notebook. Код `CsvExtractor` был исправлен: теперь он явно указывает имена колонок при чтении файла, что делает его устойчивым к проблемам с заголовками.

**Ключевые изменения в коде:**
- `pyproject.toml`: Добавлены зависимости `pandas`, `notebook`, `ipykernel`.
- `scripts/create_schema.py`: Новый скрипт для управления схемой БД.
- `src/neochef/domain/`: Созданы модели `Recipe` и `Ingredient`.
- `src/neochef/adapters/extractor.py`: Реализован `CsvExtractor`.
- `scripts/cache_recipes.py`: Новый скрипт для запуска процесса извлечения и кэширования.